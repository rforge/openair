<html><head><title>~~function to do ... ~~</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<link rel="stylesheet" type="text/css" href="Rchm.css">
</head>
<body>

<table width="100%"><tr><td>trend.level.wd(openair)</td><td align="right">R Documentation</td></tr></table><object type="application/x-oleobject" classid="clsid:1e2a7bd0-dab9-11d0-b93a-00c04fc99f9e">
<param name="keyword" value="R:   trend.level.wd">
<param name="keyword" value=" ~~function to do ... ~~">
</object>


<h2>~~function to do ... ~~</h2>


<h3>Description</h3>

<p>
~~ A concise (1-5 lines) description of what the function does. ~~
</p>


<h3>Usage</h3>

<pre>
trend.level.wd(mydata, pollutant = "nox", limits = c(0, 100), statistic = "mean", cols = "default", main = "", auto.text = TRUE, ...)
</pre>


<h3>Arguments</h3>

<table summary="R argblock">
<tr valign="top"><td><code>mydata</code></td>
<td>
~~Describe <code>mydata</code> here~~ </td></tr>
<tr valign="top"><td><code>pollutant</code></td>
<td>
~~Describe <code>pollutant</code> here~~ </td></tr>
<tr valign="top"><td><code>limits</code></td>
<td>
~~Describe <code>limits</code> here~~ </td></tr>
<tr valign="top"><td><code>statistic</code></td>
<td>
~~Describe <code>statistic</code> here~~ </td></tr>
<tr valign="top"><td><code>cols</code></td>
<td>
~~Describe <code>cols</code> here~~ </td></tr>
<tr valign="top"><td><code>main</code></td>
<td>
~~Describe <code>main</code> here~~ </td></tr>
<tr valign="top"><td><code>auto.text</code></td>
<td>
~~Describe <code>auto.text</code> here~~ </td></tr>
<tr valign="top"><td><code>...</code></td>
<td>
~~Describe <code>...</code> here~~ </td></tr>
</table>

<h3>Details</h3>

<p>
~~ If necessary, more details than the description above ~~
</p>


<h3>Value</h3>

<p>
~Describe the value returned
If it is a LIST, use
</p>
<table summary="R argblock">
<tr valign="top"><td><code>comp1 </code></td>
<td>
Description of 'comp1'</td></tr>
<tr valign="top"><td><code>comp2 </code></td>
<td>
Description of 'comp2'</td></tr>
</table>
<p>

...</p>

<h3>Warning</h3>

<p>
....
</p>


<h3>Note</h3>

<p>
~~further notes~~ 
</p>
<p>
~Make other sections like Warning with section{Warning }{....} ~
</p>


<h3>Author(s)</h3>

<p>
~~who you are~~
</p>


<h3>References</h3>

<p>
~put references to the literature/web site here ~
</p>


<h3>See Also</h3>

<p>
~~objects to See Also as <code><a onclick="findlink('utils', 'help.html')" style="text-decoration: underline; color: blue; cursor: hand">help</a></code>, ~~~
</p>


<h3>Examples</h3>

<pre>
##---- Should be DIRECTLY executable !! ----
##-- ==&gt;  Define data, use random,
##--    or do  help(data=index)  for the standard data sets.

## The function is currently defined as
function(mydata,
                pollutant = "nox", 
                limits = c(0, 100),
                statistic = "mean",
                cols = "default",
                                main = "",
                                auto.text = TRUE,...) {

    library(lattice)
    library(Hmisc)
   
    #extract variables of interest                       
    vars &lt;- c("date", "wd", pollutant)
    mydata &lt;- mydata[, vars]
    mydata &lt;- mydata[order(mydata$date), ]
    
    #zero degrees wind angle assumed to be calms - but may not be for all data sets
    mydata$wd[mydata$wd == 0] &lt;- NA

    #try adding 360 to zero
    sub360 &lt;- subset(mydata, wd == 360)
    if (nrow(sub360) &gt; 0) {
        sub360$wd &lt;- 0
        mydata &lt;- rbind(mydata, sub360)
    }
    
    ###Function to deal with completly missing data when doing max ############
    newmax &lt;- function(data) {
                            if (all(is.na(data))) { NA
                                } else {
                            max(data, na.rm = T)
                            }}
    ###########################################################################
    
    #average by year/month/wd
    if (statistic == "mean") {
          #average by year/month/wd
          means &lt;- summarize(mydata[, pollutant], llist(format(mydata$date, "%Y-%m"),
             cut2(mydata$wd, seq(0, 360, 10))), mean, na.rm = TRUE)
    } else {
          means &lt;- summarize(mydata[, pollutant], llist(format(mydata$date, "%Y-%m"),
             cut2(mydata$wd, seq(0, 360, 10))), newmax)
    }

    
    #change the names to a more readable format
    names(means) &lt;- c("date", "wd", "conc")
    
    #need to get into year/month/day
    newdate &lt;- as.character(means$date)
    newdate &lt;- paste(newdate,"-01", sep = "")
    newdate &lt;- as.Date(newdate, format = "%Y-%m-%d")
    #add to summary
    means &lt;- cbind(means, newdate)
    
    month &lt;- as.numeric(format(means$newdate, "%m"))
    year &lt;- as.factor(format(means$newdate, "%Y"))
    means$wd &lt;- as.numeric(means$wd)*10
    means &lt;- cbind(means, month, year)
    
    means$conc &lt;- means$conc
    
    #use user defined or own; own based on distribution, with upper limit
     if(missing(limits)) {
                #range between lower and 95th percentile
                breaks = seq(min(means$conc, na.rm = TRUE),
                         quantile(means$conc, probs = 0.95, na.rm = TRUE), 
                         length = 100)
         } else {
                breaks = seq(limits[1], limits[2], length = 100)     
        }
    #add max at end
    breaks = c(breaks, max(means$conc, na.rm = T))
    
    nlev2 = length(breaks)
    col.scale = breaks
    
        col &lt;- open.colours(cols, (nlev2 - 1))
    
    levelplot(conc ~ month * wd | year, 
            data = means, 
                        main = quick.text(main, auto.text),
            ylab = expression("wind direction (" *degree * ")"),
            as.table = T,
            col.regions = col, 
            at = col.scale,
            scales = list(x = list(labels = c("Jan", "Apr", "Jul", "Oct"), 
                      at = c(1, 4, 7, 10))),...)
  }
</pre>

<script Language="JScript">
function findlink(pkg, fn) {
var Y, link;
Y = location.href.lastIndexOf("\\") + 1;
link = location.href.substring(0, Y);
link = link + "../../" + pkg + "/chtml/" + pkg + ".chm::/" + fn;
location.href = link;
}
</script>


<hr><div align="center">[Package <em>openair</em> version 1.0 <a href="00Index.html">Index]</a></div>

</body></html>
